<!DOCTYPE html>
<html>
<head>
    <title>教学工作量采集与分析系统</title>
    <link rel="stylesheet" type="text/css" href="static\css\modify_page.css">
    <script src="static/script/script.js"></script>
</head>
<body>
<div class="container">
<!--导航栏 -->
	<div class="box">
		<ul class="ulList">
			<li class="liList">
				<p onclick="gotoHome()">首页</p>
			</li>
			<li class="liList">
				<p onclick="goTofilePage()">教师工作量采集</p>
			</li>
			<li class="liList">
				<p onclick="goToanalysePage()">教师工作量分析</p>
			</li>
			<li class="liList">
				<p onclick="goTomodifyPage()">教师工作量修改</p>
			</li>
		</ul>
	</div>
	<div class="content">
		<!--个人设置-->
		<div class="Top">
			<ul class="right_menu">
				<li>登出</li>
				<li>个人设置</li>
			</ul>
		</div>
		<!--主要显示内容-->
		<div class="Main_content">
			
			<form action="/modify_page" method="post">
                <p>教工号：<input type="text" name="teacher_id"> 教师名称：<input type="text" name="teacher_name"></p>
				<select name="worksheet">
					<option value="NULL">请选择要修改的表</option>
					<option value="undergraduate_workload_course_ranking">本科工作量课程排序表</option>
					<option value="undergraduate_thesis">毕业论文</option>
					<option value="department_internship">本科实习</option>
					<option value="competition_awards">学生竞赛</option>
					<option value="student_research">学生科研</option>
					<option value="undergraduate_mentorship_system">本科生导师制</option>
					<option value="educational_research_project">教研项目</option>
					<option value="first_class_courses">一流课程</option>
					<option value="teaching_achievement_awards">教学成果奖</option>
					<option value="public_services">公共服务</option>
				</select>
				<button type="submit">查询</button>
            </form>
			<div class="search_result">
				<h1>查询结果</h1>
				<table>
					<thead>
						<tr>
							{% for column in columns %}
								<th>{{ column }}</th> <!-- 显示表的列名 -->
							{% endfor %}
							<th>Actions</th> <!-- 添加操作列 -->
						</tr>
					</thead>
					<tbody>
						{% for row in result %}
							<tr>
								{% for value in row %}
								<td><span class="editable" data-value="{{ value }}">{{ value }}</span></td> <!-- 将每个单元格改为可编辑 -->
								{% endfor %}
							</tr>
							<td><button class="edit-btn">编辑</button><button class="save-btn" style="display:none;">保存</button></td> <!-- 添加编辑和保存按钮 -->
						{% endfor %}
					</tbody>
				</table>
				</div>
		</div>
	</div>
	<script>
		// 当编辑按钮点击时触发
		document.querySelectorAll('.edit-btn').forEach(function(button) {
			button.addEventListener('click', function() {
				var row = this.parentNode.parentNode;
				row.querySelectorAll('.editable').forEach(function(cell) {
					var value = cell.getAttribute('data-value');
					var input = document.createElement('input');
					input.type = 'text';
					input.value = value;
					cell.innerHTML = '';
					cell.appendChild(input);
				});
				// 显示保存按钮，隐藏编辑按钮
				row.querySelector('.edit-btn').style.display = 'none';
				row.querySelector('.save-btn').style.display = 'inline-block';
			});
		});
	
		// 当保存按钮点击时触发
		document.querySelectorAll('.save-btn').forEach(function(button) {
			button.addEventListener('click', function() {
				var row = this.parentNode.parentNode;
				var rowData = {};
				row.querySelectorAll('.editable').forEach(function(cell) {
					var columnName = cell.getAttribute('data-column'); // 获取列名
					var value = cell.querySelector('input').value;
					rowData[columnName] = value;
					cell.innerText = value;
					cell.setAttribute('data-value', value);
				});
	
				// 发送AJAX请求保存数据
				var xhr = new XMLHttpRequest();
				xhr.open('POST', '/analyse_page/update', true);
				xhr.setRequestHeader('Content-Type', 'application/json');
				xhr.onload = function() {
					if (xhr.status === 200) {
						console.log('Data updated successfully');
					} else {
						console.error('Failed to update data');
					}
				};
				xhr.send(JSON.stringify(rowData));
	
				// 隐藏保存按钮，显示编辑按钮
				row.querySelector('.save-btn').style.display = 'none';
				row.querySelector('.edit-btn').style.display = 'inline-block';
			});
		});
	</script>
</body>
</html>